<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Admin Panel - Dick Stein Practice Cup</title>
    <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
    <div class="site-container" style="max-width: 600px; margin: 40px auto;">
        <main>
            <h1>Update Current Champion</h1>
            <div class="content-card">
                <form id="update-champion-form" method="POST">
                    <p>
                        <label>Winner's Name: <input type="text" name="name" required /></label>
                    </p>
                    <p>
                        <label>Week Of: <input type="text" name="week" required /></label>
                    </p>
                    <p>
                        <label>Series Score: <input type="number" name="series" required /></label>
                    </p>
                    <p>
                        <button type="submit">Submit New Champion</button>
                    </p>
                </form>
                <div id="form-status" style="margin-top: 15px;"></div>
            </div>
        </main>
    </div>

    <script>
      const form = document.getElementById('update-champion-form');
      const statusDiv = document.getElementById('form-status');

      form.addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent the default browser form submission

        const formData = new FormData(form);
        const data = Object.fromEntries(formData.entries());

        statusDiv.textContent = 'Submitting, please wait...';
        statusDiv.style.color = 'blue';

        try {
          const response = await fetch('/.netlify/functions/update-champion', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ payload: { data } }) // Match the function's expected structure
          });

          if (!response.ok) {
            throw new Error(`Server responded with ${response.status}: ${await response.text()}`);
          }

          // If the function succeeds, redirect to the thank you page
          window.location.href = '/thank-you/';

        } catch (error) {
          console.error('Submission failed:', error);
          statusDiv.textContent = `Error: ${error.message}`;
          statusDiv.style.color = 'red';
        }
      });
    </script>
</body>
</html>
